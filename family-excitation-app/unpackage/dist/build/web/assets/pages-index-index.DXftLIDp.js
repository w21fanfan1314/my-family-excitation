import{c as t,r as e,o as i,a,w as s,b as n,d as o,n as l,e as r,f as u,t as d,i as c,g as h,h as f,F as p,j as g,k as m,l as y,m as _,p as b,q as v,s as w,u as S,v as x,x as C,y as k,z,A as I,B as $,C as B,D as M}from"./index-D-zdhaVX.js";import{_ as T,r as N,a as P,u as F,o as R,b as D,q as j,c as W,d as V}from"./user.BSxUhCHt.js";import{_ as A,a as G}from"./uni-list.CPbHKiJ4.js";const q=T({name:"UniNoticeBar",emits:["click","getmore","close"],props:{text:{type:String,default:""},moreText:{type:String,default:""},backgroundColor:{type:String,default:"#FFF9EA"},speed:{type:Number,default:100},color:{type:String,default:"#FF9A43"},fontSize:{type:Number,default:14},moreColor:{type:String,default:"#FF9A43"},single:{type:[Boolean,String],default:!1},scrollable:{type:[Boolean,String],default:!1},showIcon:{type:[Boolean,String],default:!1},showGetMore:{type:[Boolean,String],default:!1},showClose:{type:[Boolean,String],default:!1}},data:()=>({textWidth:0,boxWidth:0,wrapWidth:"",webviewHide:!1,elId:`Uni_${Math.ceil(1e6*Math.random()).toString(36)}`,elIdBox:`Uni_${Math.ceil(1e6*Math.random()).toString(36)}`,show:!0,animationDuration:"none",animationPlayState:"paused",animationDelay:"0s"}),watch:{text:function(t,e){this.initSize()}},computed:{isShowGetMore(){return!0===this.showGetMore||"true"===this.showGetMore},isShowClose(){return!(!0!==this.showClose&&"true"!==this.showClose||!1!==this.showGetMore&&"false"!==this.showGetMore)}},mounted(){this.$nextTick((()=>{this.initSize()}))},methods:{initSize(){if(this.scrollable){let e=[],i=new Promise(((e,i)=>{t().in(this).select(`#${this.elId}`).boundingClientRect().exec((t=>{this.textWidth=t[0].width,e()}))})),a=new Promise(((e,i)=>{t().in(this).select(`#${this.elIdBox}`).boundingClientRect().exec((t=>{this.boxWidth=t[0].width,e()}))}));e.push(i),e.push(a),Promise.all(e).then((()=>{this.animationDuration=this.textWidth/this.speed+"s",this.animationDelay=`-${this.boxWidth/this.speed}s`,setTimeout((()=>{this.animationPlayState="running"}),1e3)}))}},loopAnimation(){},clickMore(){this.$emit("getmore")},close(){this.show=!1,this.$emit("close")},onClick(){this.$emit("click")}}},[["render",function(t,f,p,g,m,y){const _=N(e("uni-icons"),P),b=c,v=h;return m.show?(i(),a(v,{key:0,class:"uni-noticebar",style:r({backgroundColor:p.backgroundColor}),onClick:y.onClick},{default:s((()=>[!0===p.showIcon||"true"===p.showIcon?(i(),a(_,{key:0,class:"uni-noticebar-icon",type:"sound",color:p.color,size:1.5*p.fontSize},null,8,["color","size"])):n("",!0),o(v,{ref:"textBox",class:l(["uni-noticebar__content-wrapper",{"uni-noticebar__content-wrapper--scrollable":p.scrollable,"uni-noticebar__content-wrapper--single":!p.scrollable&&(p.single||p.moreText)}]),style:r({height:p.scrollable?1.5*p.fontSize+"px":"auto"})},{default:s((()=>[o(v,{id:m.elIdBox,class:l(["uni-noticebar__content",{"uni-noticebar__content--scrollable":p.scrollable,"uni-noticebar__content--single":!p.scrollable&&(p.single||p.moreText)}])},{default:s((()=>[o(b,{id:m.elId,ref:"animationEle",class:l(["uni-noticebar__content-text",{"uni-noticebar__content-text--scrollable":p.scrollable,"uni-noticebar__content-text--single":!p.scrollable&&(p.single||p.showGetMore)}]),style:r({color:p.color,fontSize:p.fontSize+"px",lineHeight:1.5*p.fontSize+"px",width:m.wrapWidth+"px",animationDuration:m.animationDuration,"-webkit-animationDuration":m.animationDuration,animationPlayState:m.webviewHide?"paused":m.animationPlayState,"-webkit-animationPlayState":m.webviewHide?"paused":m.animationPlayState,animationDelay:m.animationDelay,"-webkit-animationDelay":m.animationDelay})},{default:s((()=>[u(d(p.text),1)])),_:1},8,["id","class","style"])])),_:1},8,["id","class"])])),_:1},8,["class","style"]),y.isShowGetMore?(i(),a(v,{key:1,class:"uni-noticebar__more uni-cursor-point",onClick:y.clickMore},{default:s((()=>[p.moreText.length>0?(i(),a(b,{key:0,style:r({color:p.moreColor,fontSize:p.fontSize+"px"})},{default:s((()=>[u(d(p.moreText),1)])),_:1},8,["style"])):(i(),a(_,{key:1,type:"right",color:p.moreColor,size:1.1*p.fontSize},null,8,["color","size"]))])),_:1},8,["onClick"])):n("",!0),y.isShowClose?(i(),a(v,{key:2,class:"uni-noticebar-close uni-cursor-point"},{default:s((()=>[o(_,{type:"closeempty",color:p.color,size:1.1*p.fontSize,onClick:y.close},null,8,["color","size","onClick"])])),_:1})):n("",!0)])),_:1},8,["style","onClick"])):n("",!0)}],["__scopeId","data-v-da5a5a2a"]]);const U=T({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(t){this.valueSync=Number(t)},modelValue(t){this.valueSync=Number(t)}},computed:{stars(){const t=this.valueSync?this.valueSync:0,e=[],i=Math.floor(t),a=Math.ceil(t);for(let s=0;s<this.max;s++)i>s?e.push({activeWitch:"100%"}):a-1===s?e.push({activeWitch:100*(t-i)+"%"}):e.push({activeWitch:"0"});return e},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(t){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:e,screenX:i}=t.changedTouches[0];this._getRateCount(e||i)},touchmove(t){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:e,screenX:i}=t.changedTouches[0];this._getRateCount(e||i)},mousedown(t){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:e}=t;this.userLastRate=this.valueSync,this._getRateCount(e),this.userRated=!0},mousemove(t){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:e}=t;this._getRateCount(e)},mouseleave(t){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!0;for(let a=0;a<e.length-1;a++)if(t.indexOf(e[a])>0){i=!1;break}return i},_getRateCount(t){this._getSize();const e=Number(this.size);if(isNaN(e))return new Error("size 属性只能设置为数字");const i=t-this._rateBoxLeft;let a=parseInt(i/(e+this.marginNumber));a=a<0?0:a,a=a>this.max?this.max:a;const s=parseInt(i-(e+this.marginNumber)*a);let n=0;(this._oldValue!==a||this.PC)&&(this._oldValue=a,n=this.allowHalf?s>e/2?a+1:a+.5:a+1,n=Math.max(.5,Math.min(n,this.max)),this.valueSync=n,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){t().in(this).select(".uni-rate").boundingClientRect().exec((t=>{t&&(this._rateBoxLeft=t[0].left)}))}}},[["render",function(t,n,u,d,c,y){const _=N(e("uni-icons"),P),b=h;return i(),a(b,null,{default:s((()=>[o(b,{ref:"uni-rate",class:"uni-rate"},{default:s((()=>[(i(!0),f(p,null,g(y.stars,((t,e)=>(i(),a(b,{class:l(["uni-rate__icon",{"uni-cursor-not-allowed":u.disabled}]),style:r({"margin-right":y.marginNumber+"px"}),key:e,onTouchstart:m(y.touchstart,["stop"]),onTouchmove:m(y.touchmove,["stop"]),onMousedown:m(y.mousedown,["stop"]),onMousemove:m(y.mousemove,["stop"]),onMouseleave:y.mouseleave},{default:s((()=>[o(_,{color:u.color,size:u.size,type:u.isFill?"star-filled":"star"},null,8,["color","size","type"]),o(b,{style:r({width:t.activeWitch}),class:"uni-rate__icon-on"},{default:s((()=>[o(_,{color:u.disabled?u.disabledColor:u.activeColor,size:u.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]);const L=T({name:"UniCard",emits:["click"],props:{title:{type:String,default:""},subTitle:{type:String,default:""},padding:{type:String,default:"10px"},margin:{type:String,default:"15px"},spacing:{type:String,default:"0 10px"},extra:{type:String,default:""},cover:{type:String,default:""},thumbnail:{type:String,default:""},isFull:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!0},shadow:{type:String,default:"0px 0px 3px 1px rgba(0, 0, 0, 0.08)"},border:{type:Boolean,default:!0}},methods:{onClick(t){this.$emit("click",t)}}},[["render",function(t,e,f,p,g,m){const b=_,v=h,w=c;return i(),a(v,{class:l(["uni-card",{"uni-card--full":f.isFull,"uni-card--shadow":f.isShadow,"uni-card--border":f.border}]),style:r({margin:f.isFull?0:f.margin,padding:f.spacing,"box-shadow":f.isShadow?f.shadow:""})},{default:s((()=>[y(t.$slots,"cover",{},(()=>[f.cover?(i(),a(v,{key:0,class:"uni-card__cover"},{default:s((()=>[o(b,{class:"uni-card__cover-image",mode:"widthFix",onClick:e[0]||(e[0]=t=>m.onClick("cover")),src:f.cover},null,8,["src"])])),_:1})):n("",!0)]),!0),y(t.$slots,"title",{},(()=>[f.title||f.extra?(i(),a(v,{key:0,class:"uni-card__header"},{default:s((()=>[o(v,{class:"uni-card__header-box",onClick:e[1]||(e[1]=t=>m.onClick("title"))},{default:s((()=>[f.thumbnail?(i(),a(v,{key:0,class:"uni-card__header-avatar"},{default:s((()=>[o(b,{class:"uni-card__header-avatar-image",src:f.thumbnail,mode:"aspectFit"},null,8,["src"])])),_:1})):n("",!0),o(v,{class:"uni-card__header-content"},{default:s((()=>[o(w,{class:"uni-card__header-content-title uni-ellipsis"},{default:s((()=>[u(d(f.title),1)])),_:1}),f.title&&f.subTitle?(i(),a(w,{key:0,class:"uni-card__header-content-subtitle uni-ellipsis"},{default:s((()=>[u(d(f.subTitle),1)])),_:1})):n("",!0)])),_:1})])),_:1}),o(v,{class:"uni-card__header-extra",onClick:e[2]||(e[2]=t=>m.onClick("extra"))},{default:s((()=>[o(w,{class:"uni-card__header-extra-text"},{default:s((()=>[u(d(f.extra),1)])),_:1})])),_:1})])),_:1})):n("",!0)]),!0),o(v,{class:"uni-card__content",style:r({padding:f.padding}),onClick:e[3]||(e[3]=t=>m.onClick("content"))},{default:s((()=>[y(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),o(v,{class:"uni-card__actions",onClick:e[4]||(e[4]=t=>m.onClick("actions"))},{default:s((()=>[y(t.$slots,"actions",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}],["__scopeId","data-v-64011453"]]);const H=T({name:"uniRow",componentName:"uniRow",props:{type:String,gutter:Number,justify:{type:String,default:"start"},align:{type:String,default:"top"},width:{type:[String,Number],default:750}},created(){},computed:{marginValue(){return this.gutter?-this.gutter/2:0},typeClass(){return"flex"===this.type?"uni-row--flex":""},justifyClass(){return"start"!==this.justify?`uni-row--flex-justify-${this.justify}`:""},alignClass(){return"top"!==this.align?`uni-row--flex-align-${this.align}`:""}}},[["render",function(t,e,n,o,u,d){const c=h;return i(),a(c,{class:l(["uni-row",d.typeClass,d.justifyClass,d.alignClass]),style:r({marginLeft:`${Number(d.marginValue)}rpx`,marginRight:`${Number(d.marginValue)}rpx`})},{default:s((()=>[y(t.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])}],["__scopeId","data-v-9ff25b7f"]]);const X=T({name:"UniSection",emits:["click"],props:{type:{type:String,default:""},title:{type:String,required:!0,default:""},titleFontSize:{type:String,default:"14px"},titleColor:{type:String,default:"#333"},subTitle:{type:String,default:""},subTitleFontSize:{type:String,default:"12px"},subTitleColor:{type:String,default:"#999"},padding:{type:[Boolean,String],default:!1}},computed:{_padding(){return"string"==typeof this.padding?this.padding:this.padding?"10px":""}},watch:{title(t){uni.report&&""!==t&&uni.report("title",t)}},methods:{onClick(){this.$emit("click")}}},[["render",function(t,e,f,p,g,m){const _=h,b=c;return i(),a(_,{class:"uni-section"},{default:s((()=>[o(_,{class:"uni-section-header",onClick:m.onClick},{default:s((()=>[f.type?(i(),a(_,{key:0,class:l(["uni-section-header__decoration",f.type])},null,8,["class"])):y(t.$slots,"decoration",{key:1},void 0,!0),o(_,{class:"uni-section-header__content"},{default:s((()=>[o(b,{style:r({"font-size":f.titleFontSize,color:f.titleColor}),class:l(["uni-section__content-title",{distraction:!f.subTitle}])},{default:s((()=>[u(d(f.title),1)])),_:1},8,["style","class"]),f.subTitle?(i(),a(b,{key:0,style:r({"font-size":f.subTitleFontSize,color:f.subTitleColor}),class:"uni-section-header__content-sub"},{default:s((()=>[u(d(f.subTitle),1)])),_:1},8,["style"])):n("",!0)])),_:1}),o(_,{class:"uni-section-header__slot-right"},{default:s((()=>[y(t.$slots,"right",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),o(_,{class:"uni-section-content",style:r({padding:m._padding})},{default:s((()=>[y(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-0a8818d5"]]);const E=T({name:"UniGridItem",inject:["grid"],props:{index:{type:Number,default:0}},data:()=>({column:0,showBorder:!0,square:!0,highlight:!0,left:0,top:0,openNum:2,width:0,borderColor:"#e5e5e5"}),created(){this.column=this.grid.column,this.showBorder=this.grid.showBorder,this.square=this.grid.square,this.highlight=this.grid.highlight,this.top=0===this.hor?this.grid.hor:this.hor,this.left=0===this.ver?this.grid.ver:this.ver,this.borderColor=this.grid.borderColor,this.grid.children.push(this),this.width=this.grid.width},beforeDestroy(){this.grid.children.forEach(((t,e)=>{t===this&&this.grid.children.splice(e,1)}))},methods:{_onClick(){this.grid.change({detail:{index:this.index}})}}},[["render",function(t,e,u,d,c,f){const p=h;return c.width?(i(),a(p,{key:0,style:r("width:"+c.width+";"+(c.square?"height:"+c.width:"")),class:"uni-grid-item"},{default:s((()=>[o(p,{class:l([{"uni-grid-item--border":c.showBorder,"uni-grid-item--border-top":c.showBorder&&u.index<c.column,"uni-highlight":c.highlight},"uni-grid-item__box"]),style:r({"border-right-color":c.borderColor,"border-bottom-color":c.borderColor,"border-top-color":c.borderColor}),onClick:f._onClick},{default:s((()=>[y(t.$slots,"default",{},void 0,!0)])),_:3},8,["class","style","onClick"])])),_:3},8,["style"])):n("",!0)}],["__scopeId","data-v-1f1eb9ce"]]);const O=T({name:"UniGrid",emits:["change"],props:{column:{type:Number,default:3},showBorder:{type:Boolean,default:!0},borderColor:{type:String,default:"#D2D2D2"},square:{type:Boolean,default:!0},highlight:{type:Boolean,default:!0}},provide(){return{grid:this}},data:()=>({elId:`Uni_${Math.ceil(1e6*Math.random()).toString(36)}`,width:0}),created(){this.children=[]},mounted(){this.$nextTick((()=>{this.init()}))},methods:{init(){setTimeout((()=>{this._getSize((t=>{this.children.forEach(((e,i)=>{e.width=t}))}))}),50)},change(t){this.$emit("change",t)},_getSize(e){t().in(this).select(`#${this.elId}`).boundingClientRect().exec((t=>{this.width=parseInt((t[0].width-1)/this.column)+"px",e(this.width)}))}}},[["render",function(t,e,n,u,d,c){const f=h;return i(),a(f,{class:"uni-grid-wrap"},{default:s((()=>[o(f,{id:d.elId,ref:"uni-grid",class:l(["uni-grid",{"uni-grid--border":n.showBorder}]),style:r({"border-left-color":n.borderColor})},{default:s((()=>[y(t.$slots,"default",{},void 0,!0)])),_:3},8,["id","class","style"])])),_:3})}],["__scopeId","data-v-551d9659"]]),Q=T({__name:"index",setup(t){const r=F(),m=b(),y=b({starCount:0,scores:[]}),T=b([]),P=v((()=>{var t;return(null==(t=y.value)?void 0:t.starCount)||0})),Q=v((()=>{var t;return null==(t=T.value)?void 0:t.map((t=>`🎉恭喜${t.user.name}同学的${t.discipline.name}获得${t.level}🎉`)).join("\t\t\t\t\t\t")}));async function J(){await r.loginValidCheck(),r.isAuth?await async function(){x({title:"加载中..."});try{await Promise.all([K(),Y(),Z()])}catch(t){C({icon:"none",title:"初始化页面数据错误"})}finally{k()}}():S({url:"/pages/login/login"})}async function K(){const t=await j({userId:r.userInfo.id});200===t.code&&(m.value=t.data)}async function Y(){const t=await W({userId:r.userInfo.id,time:Date.now()});200===t.code&&(y.value=t.data)}async function Z(){const t=await V({time:Date.now()});200===t.code&&(T.value=t.data)}async function tt(){I({title:"提示",content:"是否退出登录",confirmText:"退出登录",showCancel:!0,async success(t){if(t.confirm){x({title:"退出中..."});try{const t=await r.userQuit();200===t.code?S({url:"/pages/login/login"}):C({icon:"none",title:t.msg})}catch(e){C({icon:"none",title:"退出登录错误"})}finally{k()}}}})}return R((async()=>{await J()})),D((async()=>{try{await J()}finally{w()}})),(t,b)=>{const v=N(e("uni-notice-bar"),q),w=_,S=c,x=N(e("uni-rate"),U),C=h,k=N(e("uni-card"),L),I=$,T=N(e("uni-row"),H),F=N(e("uni-section"),X),R=N(e("uni-grid-item"),E),D=N(e("uni-grid"),O),j=N(e("uni-list-item"),A),W=N(e("uni-list"),G),V=B;return i(),a(C,{class:"index-container"},{default:s((()=>{var t,e;return[o(v,{single:"",scrollable:"",showIcon:"",text:Q.value,speed:20},null,8,["text"]),o(k,null,{default:s((()=>[o(C,{class:"user-info"},{default:s((()=>{var t;return[o(w,{class:"user-avatar",src:(null==(t=z(r).userInfo)?void 0:t.avatar)||z("/static/default_avatar.jpg")},null,8,["src"]),o(C,{class:"info-container"},{default:s((()=>[o(S,null,{default:s((()=>{var t;return[u(d(null==(t=z(r).userInfo)?void 0:t.name),1)]})),_:1}),o(x,{max:P.value,value:P.value,readonly:!0},null,8,["max","value"])])),_:1})]})),_:1})])),_:1}),o(F,{type:"line",title:"我的资产"},{right:s((()=>{var t;return[o(I,{url:"/pages/record/record?userId="+(null==(t=z(r).userInfo)?void 0:t.id)},{default:s((()=>[o(S,null,{default:s((()=>[u("查看记录")])),_:1})])),_:1},8,["url"])]})),default:s((()=>[o(T,null,{default:s((()=>[(i(!0),f(p,null,g(m.value,((t,e)=>(i(),a(k,{key:"user-balance-"+t.currency.id,"is-shadow":!1,title:t.currency.name,class:l({top0:0===e})},{default:s((()=>[o(C,{class:"amount"},{default:s((()=>[o(S,{class:"currency"},{default:s((()=>[u(d(t.currency.symbol),1)])),_:2},1024),u(" "+d(t.balance),1)])),_:2},1024)])),_:2},1032,["title","class"])))),128))])),_:1})])),_:1}),(null==(e=null==(t=y.value)?void 0:t.scores)?void 0:e.length)>0?(i(),a(F,{key:0,type:"line",title:"今日成绩"},{default:s((()=>[o(D,{column:3,"show-border":!1,square:!1},{default:s((()=>{var t;return[(i(!0),f(p,null,g(null==(t=y.value)?void 0:t.scores,((t,e)=>(i(),a(R,{key:"score-"+t.user.id+"-"+t.score.id},{default:s((()=>[o(k,{"is-shadow":!1,title:t.discipline.name,class:l({top0:e>3})},{default:s((()=>[M("h1",{style:{"text-align":"center"}},d(t.level),1)])),_:2},1032,["title","class"])])),_:2},1024)))),128))]})),_:1})])),_:1})):n("",!0),o(F,{type:"line",title:"规则介绍"},{default:s((()=>[o(W,{border:!1},{default:s((()=>[o(j,{title:"1 作业成绩拿到A或者A+获得2元奖励"}),o(j,{title:"2 如果每天可以集齐3颗星(🌟🌟🌟)额外获得2元奖励"}),o(j,{title:"3 作业不认真对待,写字不公正等需要处罚",note:"处罚1: 订正内容每个部分写一篇"})])),_:1})])),_:1}),o(V,{type:"error",style:{width:"690rpx","margin-top":"80rpx","margin-bottom":"30rpx"},onClick:tt},{default:s((()=>[u("退出登录")])),_:1})]})),_:1})}}},[["__scopeId","data-v-1964dabb"]]);export{Q as default};
